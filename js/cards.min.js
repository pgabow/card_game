const e=document.querySelector("#start"),t=document.querySelector("#over"),l=document.querySelectorAll(".screen"),o=document.querySelector(".modal"),s=document.querySelector(".overlay-modal"),c=document.querySelector(".modal__description"),a=document.querySelector(".modal__description-time"),r=document.querySelector("#board"),i=document.querySelector(".over__description"),n=document.querySelector(".over__description-level"),d=document.querySelector(".over__description-time"),u=document.querySelector("#level-list"),p=[1,1,2,2,3,3,4,4,5,5,6,6,7,7,8,8],m=[],g=[];let f=0,y=0,v=0;const L=p.length/2;let _,h,b,q,S,M=null,k=null,T=!1;const A=new Audio;A.loop=!0;const w=new Audio,E=new Audio,H=new Audio;A.src="../sound/music.mp3",w.src="../sound/sound.mp3",E.src="../sound/sound2.mp3",H.src="../sound/sound3.mp3",e.onclick=e=>{e.preventDefault(),w.play(),l[0].classList.add("up")},t.onclick=e=>{e.preventDefault(),clearInterval(k),m.splice(0,16),g.splice(0,2),r.innerHTML="",f=0,y=0,v=0,T=!1,l[0].classList.remove("up"),l[1].classList.remove("up"),l[2].classList.remove("up"),w.play()},u.onclick=e=>{e.preventDefault(),e.target.classList.contains("level-btn")&&(q=parseInt(e.target.getAttribute("data-level")),l[1].classList.add("up"),console.log("level ",q),w.play(),j())};const $=(e=1)=>{for(let t=0;t<p.length;t++){let l={suit:!1,flip:!1,number:p[t],order:Math.floor(16e3*Math.random()*e)+1};m.push(l)}m.sort(((e,t)=>e.order<t.order?-1:1))},D=(e,t)=>Math.floor(Math.random()*(t-e+1))+e,I=(e=2)=>{const t=document.querySelectorAll(".card > .card__face.card__face--back");t.forEach((t=>t.style.backgroundImage=`url('../img/bg${D(1,e)}.jpg')`)),T?(t[D(1,15)].style.backgroundImage="url('../img/bg9.jpg')",t[D(1,15)].style.backgroundImage="url('../img/bg10.jpg')"):t[D(1,15)].style.backgroundImage="url('../img/bg10.jpg')"},j=()=>{switch($(q),(()=>{for(let e=0;e<m.length;e++){const t=document.createElement("div");t.classList.add("card"),t.dataset.card=m[e].number,t.innerHTML=`<div class="card__face card__face--front" data-card="${m[e].number}"><p>${m[e].number}</p></div>\n\t\t<div class="card__face card__face--back" data-card="${m[e].number}"></div>`,t.classList.add("is-flipped"),r.append(t)}})(),q){case 1:_=600,S="простой";break;case 4:_=400,S="средний",I(q);break;case 8:_=300,S="сложный",T=!0,document.querySelectorAll(".card").forEach((e=>{2===D(1,2)&&e.classList.add("rotate--front")})),I(q)}const e=document.querySelectorAll(".card");e.forEach(((t,r)=>{t.addEventListener("click",(function(u){u.preventDefault(),w.play(),m[r].flip||m[r].suit?v<L&&!m[r].suit&&(t.classList.toggle("is-flipped"),m[r].flip=!m[r].flip,g.splice(0,1)):(f++,w.play(),1===f&&(h=Date.now()),50===f&&(A.pause(),H.play(),o.classList.add("active"),s.classList.add("active"),c.innerHTML=`Уже было ${f} попыток`,a.innerHTML="Надо быть более внимательным"),T&&(y++,console.log("Тучи сгущаются ",y),A.play()),y>14?(y=0,v=0,g.length>0&&g.splice(0,g.length),m.forEach((e=>{e.flip=!1,e.suit=!1})),clearTimeout(M),e.forEach((e=>{e.classList.add("is-flipped")}))):(t.classList.toggle("is-flipped"),m[r].flip=!m[r].flip,g.push({item:u.target.dataset.card,position:r}),g.length>1&&(g[0].item===g[1].item?(m[g[0].position].suit=!0,m[g[1].position].suit=!0,g.splice(0,2),clearTimeout(M),T&&(y-=2,console.log("Барсук выдыхай ",y)),v++,v==L&&(b=Date.now(),A.pause(),E.play(),i.innerHTML=`Всего  попыток: ${f}.`,n.innerHTML=`Уровень игры <span>${S}</span>.`,d.innerHTML="Время игры: "+x(b-h),k=setTimeout((()=>{l[2].classList.add("up")}),1e3))):M=setTimeout((()=>{m[g[0].position].flip=!1,m[g[1].position].flip=!1,e[g[0].position].classList.toggle("is-flipped"),e[g[1].position].classList.toggle("is-flipped"),g.splice(0,2)}),_))))}))}))},x=e=>{let t=Math.floor(e%1e3/100),l=Math.floor(e/1e3%60),o=Math.floor(e/6e4%60);return o=o<10?"0"+o:o,l=l<10?"0"+l:l,t=t<10?"0"+t:t,o+"м "+l+"с "+t+"мс"};